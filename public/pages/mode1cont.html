<!DOCTYPE html>

  <html>

    <head>
      <title>CPEN291 Drawbot</title>
      <meta charset="utf-8">
      <link rel="stylesheet" type="text/css" href="../styles/style.css">
    </head>

    <body>

      <header>
        <div class="container">
          <div class="logo">
            <img src="../styles/logo.jpg" alt="Drawbot Logo">
          </div>
          <nav class="navigation-top">
            <ul>
              <li><a href="../index.html" class="nav-link">Home</a></li>
              <li><a href="#" class="nav-link">Mode1</a></li>
              <li><a href="mode2cont.html" class="nav-link">Mode2</a></li>
              <li><a href="showcase.html" class="nav-link">Showcase</a></li>
            </ul>

            <div class="dropdown">
              <button class="button-dropdown">Menu</button>
              <div class="dropdown-content">
                <a href="../index.html">Home</a>
                <a href="mode2cont.html">Mode 2</a>
                <a href="showcase.html">Showcase</a>
              </div>
            </div>
          </nav>
        </div>
      </header>

      <div class = "mode1_title">
        <h1>MODE 1</h1> 
      </div>
      
      <section class="mode-1-sub" id="Mode1">
        <script>
          function printShape(shape) {
            document.getElementById("demo").innerHTML = shape;
          }
        </script>

        <div class="option1">
          <h2>① Choose one shape below:</h2>
          <div class="shapes"> 
            <input type="image" src="../styles/shape_square.jpg" id = "square" class = "block" onclick="printShape('SQUARE')" value = "square"> 
        
            <input type="image" src="../styles/shape_triangle.jpg" id = "triangle" class = "block" onclick="printShape('TRIANGLE')" value = "triangle"> 
       
            <input type="image" src="../styles/shape_circle.jpg" id = "circle" class = "block" onclick="printShape('CIRCLE')" value = "circle"> 
            <br>

            <input type="image" src="../styles/shape_rectangle.jpg" id = "rectangle" class = "block" onclick="printShape('RECTANGLE')" value = "rectangle"> 
  
            <input type="image" src="../styles/shape_heart.jpg" id = "heart" class = "block" onclick="printShape('HEART')" value = "heart"> 

            <input type="image" src="../styles/shape_oval.jpg" id = "oval" class = "block" onclick="printShape('OVAL')" value = "oval"> 
          </div>
          <div class = "shape_text">
            <p>You've chosen: </p>
            <p id="demo"></p>
          </div>
        </div>

        <div class="option2">
          <h2>② Click submit to write the text:</h2> 
          <div class="chatbox">
            <h1>TEXT</h1>
            <div class="input">
              <label for="fname"> <br> Input text:</label>
              <input type="text" id="content" placeholder="Enter content max length 40" maxlength="40">
            </div>  
            <button type="button" id="submit">submit</button>
          </div>

          <script>
            var al;
            var Wrapper = {
              width: 50,
              height: 50,
              images: [],
              bgColor: '#cba3e9',
              getElement(id) {
                var element = document.getElementById(id);
                if (element) {
                  return element;
                }
                element = document.getElementsByName(id);
                if (element) {
                  return element[0];
                }
                element = document.getElementsByClassName(id);
                if (element) {
                  return element;
                }
                element = document.getElementsByTagName(id);
                if (element) {
                  return element[0];
                }
                return null;
              },

              fillText(ctx, text) {
                text = /^[a-zA-Z]*$/.test(text) ? text.toLocaleUpperCase() : text;
                ctx.fillStyle = 'white';
                ctx.font = "30px Arial";
                //ctx.translate(20, 50);
                ctx.fillText(text, 20, 50);
              },

              drawImage(text) {
                var canvas = document.createElement('canvas');
                var ctx = canvas.getContext('2d');
                var image = new Image();
                var imageIndex = Math.floor(Math.random() * 10);
                var url = this.images[imageIndex];
                image.src = url;
            
                canvas.width = this.width;
                canvas.height = this.height;
                var self = this;
                var self = this;
                return new Promise(function (resolve) {
                  image.onload = function () {
                    var wScale = self.width / image.width;
                    var yScale = self.height / image.height;
                    //ctx.drawImage(image, 0, 0, image.width, image.height, 0, 0, image.width * wScale, image.height * yScale);
                    self.fillText(ctx, text);
                    resolve(canvas);
                  };
                });
              },

              resetBgColor() {
                this.ctx.fillStyle = this.bgColor;
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
              },

              btn_submit() {
                var self = this;
                let content = this.getElement('content');
                if (!content.value) {
                  return;
                }                
                if(al) {
                  alert('invaild input, please enter only characters');
                }
                
                const aList = content.value.split('');
                const rowSize = Math.ceil(aList.length / 10);
                const contentSplit = [];
            
                for (let i = 0; i < rowSize; i++) {
                  contentSplit.push(aList.splice(0, 10).join(''));
                }
            
                this.btn_clear();
                
                let splitList = [];
                contentSplit.forEach((item) => {
                  console.log('item:', item);
                  for (let i = 0; i < item.length; i++) {
                    splitList.push(self.drawImage(item[i]));
                    //splitList.push(self.fillText(item[i]));
                  }
                });
            
                Promise.all(splitList).then(function (img) {
                  let len = 0;
                  contentSplit.forEach(function (item, index) {
                    if (index) {
                      len += contentSplit[index - 1].length;
                    }
                    for (let i = 0; i < item.length; i++) {
                      self.ctx.drawImage(img[i + len], i * 35 + 50, index * 55);
                    }
                  });
                });
              },

              btn_clear() {
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                this.resetBgColor();
                let content = this.getElement('content');
                content.value = '';
              },
              
              init() {
                var self = this;
                this.canvas = this.getElement('canvas');
                this.ctx = canvas.getContext('2d');
                var btn_submit = this.getElement('submit');
                var btn_clear = this.getElement('clear');
                btn_submit.onclick = function () {
                  self.btn_clear();
                };
                btn_clear.onclick = function () {
                  self.btn_clear();
                };
                this.resetBgColor();
              },
            }

            window.onload = function () {
              Wrapper.init();
            };
          </script>
        </div>

      </section>

      <div id="status">
        <h3 id="drawing">Drawing ...</h3>
        <h3 id="done">Done!</h3>
      </div>

      <footer>
        <p>Updated: March 31st, 2022</p>
      </footer>

      <script src="/socket.io/socket.io.js"> </script>
      <script>
        const socket = io();

        // Update drawing status to "Done" when it is done drawing 

        socket.on('Done1', (msg) => {
          document.getElementById("drawing").style.display = "none";
          document.getElementById("status").style.backgroundColor = "green";
          document.getElementById("done").style.display = "block";
          setTimeout(() => {
            document.getElementById("done").style.display = "none";
          }, 1400);
        });

        // Button sockets

        const squarebtn = document.getElementById("square");
        squarebtn.addEventListener("click", () =>{
          document.getElementById("drawing").style.display = "block";
          socket.emit('square_cmd', squarebtn.value);        
        });

        const trianglebtn = document.getElementById("triangle");
        trianglebtn.addEventListener("click", () =>{
          document.getElementById("drawing").style.display = "block";
          socket.emit('triangle_cmd', trianglebtn.value);        
        });

        const circlebtn = document.getElementById("circle");
        circlebtn.addEventListener("click", () =>{
          document.getElementById("drawing").style.display = "block";
          socket.emit('circle_cmd', circlebtn.value);        
        });

        const rectanglebtn = document.getElementById("rectangle");
        rectanglebtn.addEventListener("click", () =>{
          document.getElementById("drawing").style.display = "block";
          socket.emit('rectangle_cmd', rectanglebtn.value);        
        });

        const heartbtn = document.getElementById("heart");
        heartbtn.addEventListener("click", () =>{
          document.getElementById("drawing").style.display = "block";
          socket.emit('heart_cmd', heartbtn.value);        
        });

        const ovalbtn = document.getElementById("oval");
        ovalbtn.addEventListener("click", () =>{
          document.getElementById("drawing").style.display = "block";
          socket.emit('oval_cmd', ovalbtn.value);        
        });

        const submitbtn = document.getElementById("submit");
        const input = document.getElementById("content")
        submitbtn.addEventListener("click", () =>{
          socket.emit('input', content.value);
        })

      </script>

    </body>

  </html>
  

  
